name: CI-docs-website

on:
  push:
    branches:
      - main
    paths:
      - 'docs/**'
      - '.github/actions/**'
      - '.github/workflows/**'

  # Allows you to run this workflow manually from the Actions tab
  workflow_dispatch:

permissions:
  contents: read
  pages: write
  id-token: write

jobs:
  build-and-deploy-docs-website:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    env:
      NEXTJS_IGNORE_ESLINT: true
      NEXTJS_IGNORE_TYPECHECK: true
      NEXT_DISABLE_SOURCEMAPS: true
      NEXT_TELEMETRY_DISABLED: true
    steps:
      - name: Cancel Previous Runs
        uses: styfle/cancel-workflow-action@0.12.0

      - uses: actions/checkout@v4
        with:
          persist-credentials: true

      - name: ‚öôÔ∏è Setup node 20
        uses: actions/setup-node@v4
        with:
          node-version: "20.x"

      - name: üì• Monorepo install
        uses: ./.github/actions/yarn-nm-install

      - name: üèó Build docs
        run: yarn website:build

      - name: üöÄ Deploy
        if: ${{ github.repository == 'belgattitude/httpx' && contains('refs/heads/main',github.ref)}}
        run: |
          git remote set-url origin https://git:${GITHUB_TOKEN}@github.com/${GITHUB_REPOSITORY}.git
          yarn website:deploy -u "github-actions-bot <support+actions@github.com>"
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

